function bind(){document.getElementById("choose").setAttribute("onclick","bind_choose();"),document.getElementById("line").setAttribute("onclick","bind_line();"),document.getElementById("rectangle").setAttribute("onclick","bind_rectangle();"),document.getElementById("circle").setAttribute("onclick","bind_circle();"),document.getElementById("color").setAttribute("onchange","color_change();"),document.getElementById("fill").setAttribute("onclick","bind_fill();")}function bind_fill(){document.getElementById("page").setAttribute("onmousedown","get_model_fill();"),document.getElementById("page").setAttribute("onmouseup",""),document.getElementById("page").style.cursor=""}function bind_choose(){document.getElementById("page").setAttribute("onmousedown","get_model();"),document.getElementById("page").setAttribute("onmouseup",""),document.getElementById("page").style.cursor=""}function bind_line(){document.getElementById("page").setAttribute("onclick",""),document.getElementById("page").setAttribute("onmousedown","drawLine1();"),document.getElementById("page").setAttribute("onmouseup","drawLine2();"),document.getElementById("page").style.cursor="crosshair"}function bind_rectangle(){document.getElementById("page").setAttribute("onclick",""),document.getElementById("page").setAttribute("onmousedown","drawRectangle1();"),document.getElementById("page").setAttribute("onmouseup","drawRectangle2();"),document.getElementById("page").style.cursor="crosshair"}function bind_circle(){document.getElementById("page").setAttribute("onmousedown",""),document.getElementById("page").setAttribute("onmouseup",""),document.getElementById("page").setAttribute("onclick","drawCircle()"),document.getElementById("page").style.cursor="crosshair"}function color_change(){var t=document.getElementById("color").options.selectedIndex,e=document.getElementById("color").options[t].value;document.getElementById("incolor").value=e}function get_x(){var t=event.clientX;return t-61}function get_y(){var t=event.clientY;return t-40}function drawLine1(){var t=get_x(),e=get_y(),n=0,o=0,c=0,r=new Factory;r.createProduct1(t,e,n,o,c).cnv()}function drawLine2(){var t=get_x(),e=get_y(),n=document.getElementById("x").value,o=document.getElementById("y").value,c=document.getElementById("incolor").value,r=new Factory,a=r.createProduct1(n,o,t,e,c);line[l]=a,l++,a.draw()}function drawRectangle1(){var t=get_x(),e=get_y(),n=0,o=0,c=0,r=new Factory;r.createProduct2(t,e,n,o,c).cnv()}function drawRectangle2(){var t=get_x(),e=get_y(),n=document.getElementById("x").value,o=document.getElementById("y").value,c=e-o,a=t-n,i=document.getElementById("incolor").value,u=new Factory,l=u.createProduct2(n,o,a,c,i);rectangle[r]=l,r++,l.draw()}function drawCircle(){var t=get_x(),e=get_y(),n=document.getElementById("r2").value,o=document.getElementById("incolor").value,r=new Factory,a=r.createProduct3(t,e,n,o);circle[c]=a,c++,a.cnv(),a.draw()}function pageInit(){mainCanvas=document.getElementById("page"),mainCanvas.setAttribute("onmousedown","canvasMouseDownHandler(event);"),canvasMouseDownHandler(event),mainCanvas.setAttribute("onmouseup","canvasMouseUpHandler(event);"),redrawRect()}function canvasMouseDownHandler(t){var e=t.layerX;e||(e=t.x);var n=t.layerY;n||(n=t.y),e>currentRectX&&currentRectX+RECT_WIDTH>e&&n>currentRectY&&currentRectY+RECT_HEIGHT>n&&(mainCanvas.setAttribute("onmousemove","canvasMouseMoveHandler(event);"),canvasMouseMoveHandler(t),startDragMouseX=e,startDragMouseY=n,startDragRectX=currentRectX,startDragRectY=currentRectY)}function canvasMouseMoveHandler(t){var e=t.layerX;e||(e=t.x);var n=t.layerY;n||(n=t.y),currentRectX=startDragRectX+e-startDragMouseX,currentRectY=startDragRectY+n-startDragMouseY,redrawRect()}function canvasMouseUpHandler(){mainCanvas.onmousemove=null}function redrawRect(){var t,e,n;mainCt=mainCanvas.getContext("2d"),mainCt.clearRect(0,0,MAIN_CANVAS_WIDTH,MAIN_CANVAS_HEIGHT),mainCt.fillStyle=color,mainCt.fillRect(currentRectX,currentRectY,RECT_WIDTH,RECT_HEIGHT),change_model();for(t in line)line[t].draw();for(e in rectangle)e!=Now&&rectangle[e].draw();for(n in circle)circle[n].draw()}function move_rectangle(t,e){Now=e,currentRectX=t.point_x1,currentRectY=t.point_y1,startDragRectX=0,startDragRectY=0,startDragMouseX=0,startDragMouseY=0,RECT_WIDTH=t.width,RECT_HEIGHT=t.height,color=t.color,pageInit()}function get_model(){var t,e,n=get_x(),o=get_y();for(e in rectangle)n>=rectangle[e].point_x1&&n<=rectangle[e].point_x1+rectangle[e].width&&o>=rectangle[e].point_y1&&o<=rectangle[e].point_y1+rectangle[e].height&&(t=rectangle[e],document.getElementById("page").setAttribute("onmousedown",""),move_rectangle(t,e));for(e in circle){var c=Math.abs(n-circle[e].point_x),r=Math.abs(o-circle[e].point_y),a=Math.sqrt(c*c+r*r);a<=circle[e].r&&(t=circle[e],document.getElementById("page").setAttribute("onmousedown",""),move_rectangle(t))}}function change_model(){rectangle[Now].pointx_1=currentRectX,rectangle[Now].pointx_2=currentRectY,rectangle[Now].width=RECT_WIDTH,rectangle[Now].height=RECT_HEIGHT}function color_fill(t){var e=document.getElementById("page"),n=document.getElementById("incolor").value;currentRectX=t.point_x1,currentRectY=t.point_y1,RECT_WIDTH=t.width,RECT_HEIGHT=t.height,mainCt=e.getContext("2d"),mainCt.clearRect(0,0,MAIN_CANVAS_WIDTH,MAIN_CANVAS_HEIGHT),mainCt.fillStyle=n,mainCt.fillRect(currentRectX,currentRectY,RECT_WIDTH,RECT_HEIGHT)}function get_model_fill(){var t,e,n=get_x(),o=get_y();for(e in rectangle)n>=rectangle[e].point_x1&&n<=rectangle[e].point_x1+rectangle[e].width&&o>=rectangle[e].point_y1&&o<=rectangle[e].point_y1+rectangle[e].height&&(t=rectangle[e],document.getElementById("page").setAttribute("onmousedown",""),color_fill(t));for(e in circle){var c=Math.abs(n-circle[e].point_x),r=Math.abs(o-circle[e].point_y),a=Math.sqrt(c*c+r*r);a<=circle[e].r&&(t=circle[e],document.getElementById("page").setAttribute("onmousedown",""))}}var l=0,r=0,c=0,line=new Array,rectangle=new Array,circle=new Array,MAIN_CANVAS_WIDTH=1280,MAIN_CANVAS_HEIGHT=600,currentRectX=0,currentRectY=0,startDragRectX=0,startDragRectY=0,startDragMouseX=0,startDragMouseY=0,RECT_WIDTH=0,RECT_HEIGHT=0,color,Now,mainCt;window.onload=bind;